unit uBanco;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, uHerancaCadastros, Data.DB, Vcl.DBCtrls,
  Vcl.StdCtrls, Vcl.Grids, Vcl.DBGrids, Vcl.Mask, Vcl.ExtCtrls, Vcl.ComCtrls, uEnum,
  ZAbstractRODataset, ZAbstractDataset, ZDataset, cBanco, uDTMConexao;

type
  TfrmCadBancos = class(TfrmHerancaCadastros)
    edtCodigo: TLabeledEdit;
    ckSituacao: TCheckBox;
    edtNome: TLabeledEdit;
    QryListagemGridIdBanco: TLargeintField;
    QryListagemGridnome: TWideStringField;
    QryListagemGridsituacao: TWideStringField;
    procedure FormShow(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure FormCreate(Sender: TObject);
    procedure btnAlterarClick(Sender: TObject);

  private
    { Private declarations }
    objBanco : TBanco;
    function Gravar(EstadoTela : TEstadoDaTela)  : Boolean; override;
    function Excluir  : Boolean;

    function SituacaoEmTexto(ativo : Boolean) : String;
    function TextoEmSituacao(texto : string)  : boolean;

  public
    { Public declarations }
  end;

var
  frmCadBancos: TfrmCadBancos;

implementation

{$R *.dfm}

{$region 'Eventos da propria tela e botões'}

procedure TfrmCadBancos.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  inherited;
  if Assigned(objBanco) then
    FreeAndNil(objBanco);
end;

procedure TfrmCadBancos.FormCreate(Sender: TObject);
begin
  inherited;
  objBanco    := TBanco.Create(DtmConexaoPrincipal.ConexaoDB);
end;

procedure TfrmCadBancos.FormShow(Sender: TObject);
begin
  inherited;
  //QryListagemGrid.Open;
end;



procedure TfrmCadBancos.btnAlterarClick(Sender: TObject);
begin
  inherited;
  if (objBanco.SelecionarRegistro(QryListagemGrid.FieldByName('IdBanco').AsInteger)) then
  begin
    edtCodigo.Text          := IntToStr(objBanco.codigo);
    edtNome.Text            := objBanco.nome;
    ckSituacao.Checked      := TextoEmSituacao(objBanco.situacao);
  end
  else begin
    btnCancelar.Click;
    Abort;
  end;
end;

function TfrmCadBancos.Excluir: Boolean;
begin
  ShowMessage('Registro excluído!');
end;
{$endregion}



function TfrmCadBancos.Gravar(EstadoTela: TEstadoDaTela): Boolean;
begin
    if (edtCodigo.Text <> EmptyStr) then
      objBanco.codigo  := StrToInt(edtCodigo.Text)
    else
      objBanco.codigo  := 0;

    objBanco.nome        := edtNome.Text;
    objBanco.situacao    := SituacaoEmTexto(ckSituacao.Checked);

    if (EstadoTela = etNovo) then
    begin
      Result    := objBanco.InserirRegistro;
      ShowMessage('Cadastrado com Sucesso!')
    end
    else if (EstadoTela = etAlterar) then
    begin
      Result    :=  true; //objBanco.A
      ShowMessage('Alterado com sucesso')
    end;
end;



function TfrmCadBancos.SituacaoEmTexto(ativo: Boolean): String;
begin
  inherited
end;



function TfrmCadBancos.TextoEmSituacao(texto: string): boolean;
begin
  inherited
end;



end.
